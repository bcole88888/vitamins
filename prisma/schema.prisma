generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id                     String                  @id @default(cuid())
  name                   String
  createdAt              DateTime                @default(now())
  intakes                IntakeLog[]
  regimens               Regimen[]
  notificationPreference NotificationPreference?
}

model Product {
  id           String        @id @default(cuid())
  upc          String?       @unique
  name         String
  brand        String?
  servingSize  Float?
  servingUnit  String?
  imageUrl     String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  nutrients    Nutrient[]
  intakes      IntakeLog[]
  regimenItems RegimenItem[]
}

model Nutrient {
  id                String  @id @default(cuid())
  productId         String
  product           Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  name              String
  amount            Float
  unit              String
  dailyValuePercent Float?

  @@unique([productId, name])
}

model IntakeLog {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  date      DateTime @default(now())
  quantity  Float    @default(1)
  createdAt DateTime @default(now())

  @@index([userId, date])
}

model Regimen {
  id        String        @id @default(cuid())
  userId    String
  user      User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  name      String        @default("Daily Regimen")
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  items     RegimenItem[]

  @@unique([userId, name])
  @@index([userId])
}

model RegimenItem {
  id           String   @id @default(cuid())
  regimenId    String
  regimen      Regimen  @relation(fields: [regimenId], references: [id], onDelete: Cascade)
  productId    String
  product      Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  quantity     Float    @default(1)
  sortOrder    Int      @default(0)
  scheduleDays String   @default("0,1,2,3,4,5,6") // CSV: 0=Sun to 6=Sat
  createdAt    DateTime @default(now())

  @@unique([regimenId, productId])
  @@index([regimenId])
}

model NotificationPreference {
  id           String   @id @default(cuid())
  userId       String   @unique
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  enabled      Boolean  @default(false)
  reminderTime String   @default("09:00")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}
